{% extends "base.html" %}
{% load l10n %}
{% load i18n %}
{% load replace %}

{% block title %}{% trans "Map" %} - {{ display_title }} {% endblock %}
{% block head %}{% trans "Map" %} - {{ display_title }} {% endblock %}
{% block content %}

  {% include "map_page_script.html" %}

  {% include "map_page_modal_info.html" %}   
  
  <div class="row-fluid" ng-controller="MapCtrl">       
    <div id="nav_bar" class="span3 hidden-phone hidden-tablet">  
    
      <div style="margin-top:10px;">
        <b>{% trans 'Search' %}</b>
        <input class="input-medium search-query" ng-model="query">
      </div>
      <hr/>                      
      <div id="nav_content">
        <div class="nav-header">
          <a href="#" rel="popover" data-content="{{countries}}" 
            data-placement="bottom" data-original-title="<[total_country]> {% trans 'countries' %}">
            <[total_location]> {% trans 'places' %} | <[total_country]> {% trans 'countries' %}
          </a>
        </div>
        <br/>
        <div class="accordion" id="my_accordion">      
          <div ng-repeat="nav in navs" class="accordion-group">
            <div class="accordion-heading nav-header">
              <a class="accordion-toggle" data-toggle="collapse" data-parent="#my_accordion" href="#collapse<[nav.index]>">
                <[nav.country]> (<[nav.count]>)
              </a>
            </div>
            <div id="collapse<[nav.index]>" class="accordion-body collapse">
              <div class="accordion-inner">
                <ul class="nav nav-list nav-content">
                  <li ng-repeat="loc in nav.locations | filter:search | orderBy:'position'"
                    onclick="nav_click_event(<[loc.id]>);" class="<[loc.class]>" my-repeat-directive>
                    <a href="#" id="<[loc.id]>" class="location"
                      lat="<[loc.lat]>" lng="<[loc.lng]>">
                      <i class="icon-picture" style="display:<[loc.image_style]>;"></i>
                      <[loc.name]>
                    </a>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>        
      </div>
      
    </div>    
    <div id="map_container" class="span9 span12-tablet">      
      {% if user.is_authenticated %}
      <div class="navbar">
        <div class="navbar-inner">
          <div class="container">
          
            <a class="btn btn-navbar" data-toggle="collapse" data-target="#map_filter">
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </a>
          
            <a class="brand" href="#">{% trans "Display" %}</a>

            <div id="map_filter" class="nav-collapse collapse">
              <ul id="display_menu" class="nav">
                <li id="show_monk" class="<[show_monk_pressed]>">
                  <a href="#" ng-click="reload_data({{MONK}})">{% trans "Monk" %}</a>
                </li>
                <li id="show_layperson" class="<[show_layperson_pressed]>">
                  <a href="#" ng-click="reload_data({{LAYPERSON}})">{% trans "Layperson" %}</a>
                </li>
              </ul>
              <ul class="nav pull-right">
                <li class="divider-vertical"></li>
                <li>
                  <a href="https://spreadsheets.google.com/viewform?formkey=dFRRZ3djOVVVX3IxYTExUEZDamI3enc6MQ">{% trans 'CDs/books request' %}</a>
                </li>              
              </ul>
            </div>            
          </div>
        </div>
      </div>
      {% endif %}
      
      <div ng-repeat="marker in myMarkers" ui-map-marker="myMarkers[$index]" 
        ui-event="{'map-click': 'show_dialog_info(marker)', 'map-mouseover': 'show_window_info(marker)', 'map-mouseout': 'dismiss_window_info(marker)'}">
      </div>

      <div ui-map-info-window="myInfoWindow" ng-bind-html="currentContent">
        <[ currentContent ]>
      </div>
      
      <div id="map_canvas" ui-map="myMap" class="map"
        ui-event="{'map-idle': 'init()'}" ui-options="mapOptions">
      </div>
      
    </div>
  </div>
    
  <div id="modal-gallery" class="modal modal-gallery hide fade modal-fullscreen" tabindex="-1" aria-hidden="true">
      <div class="modal-header">
          <a class="close" data-dismiss="modal">&times;</a>
          <h3 class="modal-title"></h3>
      </div>
      <div class="modal-body"><div class="modal-image"></div></div>
      <div class="modal-footer">
          <a class="btn btn-info modal-prev"><i class="icon-arrow-left icon-white"></i> Previous</a>
          <a class="btn btn-primary modal-next">Next <i class="icon-arrow-right icon-white"></i></a>
          <a class="btn btn-success modal-play modal-slideshow" data-slideshow="5000"><i class="icon-play icon-white"></i> Slideshow</a>
          <a class="btn modal-download" target="_blank"><i class="icon-download"></i> Download</a>
      </div>
  </div>
  
<script src="{{ STATIC_URL }}file_upload/js/load-image.min.js"></script>
<script src="{{ STATIC_URL }}bootstrap/js/bootstrap-image-gallery.js"></script>

<p id="back-top">
  <a href="#top"><span></span>Back to Top</a>
</p>

{% endblock %}

{% block footer %}{% include "footer.html" %}{% endblock %}

