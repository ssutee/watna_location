{% extends "base.html" %}
{% load l10n %}
{% load i18n %}
{% load replace %}

{% block title %}{% trans "Map" %} - {{ display_title }} {% endblock %}
{% block head %}{% trans "Map" %} - {{ display_title }} {% endblock %}
{% block content %}

  {% include "map_page_script.html" %}

  <div id="info_modal" class="modal hide fade" tabindex="-1" role="dialog" 
    aria-labelledby="info_modal_label" aria-hidden="true">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
      <h3 id="info_modal_label"></h3>
    </div>    
    <div class="modal-body">
      <table class="table" style="border-color: blue !important;">
        <tbody>
          <tr>
            <td>
              <strong>{% trans 'Contact name' %}</strong>
              <p id="contact_name"> </p>  
            </td>
            <td>
              <strong>{% trans 'Phone number' %}</strong>
              <p id="phone_number"> </p>            
            </td>
            <td>
              <strong>{% trans 'E-mail' %}</strong>
              <p id="email"> </p>            
            </td>
          </tr>
          <tr>
            <td colspan="2">
              <strong>{% trans 'Address' %}</strong>
              <p id="address"> </p>            
            </td>
            <td>
              <strong>{% trans 'City/Country' %}</strong>
              <p id="city"> </p>            
            </td>            
          </tr>
          <tr>
            <td colspan="3">
              <strong>{% trans 'Activities' %}</strong>
              <p id="activities"> </p>            
            </td>            
          </tr>
          <tr>
            <td colspan="2">
              <strong>{% trans 'Additional information' %}</strong>
              <p id="additional_info"> </p>            
            </td>            
            <td id="td_id_relation">
              <strong>{% trans 'Organization relationship' %}</strong>
              <p id="relation"> </p>            
            </td>            
          </tr>
          <tr id="tr_id_gallery">
            <td colspan="3">
              <strong>{% trans 'Pictures' %}</strong>
              <div style="margin-top:5px" id="gallery" data-dismiss="modal" data-toggle="modal-gallery" data-target="#modal-gallery">
              </div>            
            </td>
          </tr>          
        </tbody>
      </table>
    </div>
    <div class="modal-footer">
      <button id="btn_pictures" class="btn btn-success" data-dismiss="modal"
       data-target="#modal-gallery" data-selector="#gallery a[rel=gallery]">
        {% trans "Pictures" %}
      </button>
      <button class="btn" data-dismiss="modal" aria-hidden="true">{% trans "Close" %}</button>
    </div>
  </div>     
  <div class="row-fluid">       
    <div id="nav_bar" class="span3 hidden-phone hidden-tablet">  
      <ul class="nav nav-list bs-sidenav" ng-controller="NavCtrl">   
        <div style="margin-top:10px;">
          <b>{% trans 'Search' %}</b>
          <input class="input-medium search-query" ng-model="query">
        </div>
        <hr/>        
        <li class="nav-header"><a href="#" rel="popover" data-content="{{countries}}" data-placement="bottom" data-original-title="Countries ({{total_country}})">Total ({{total}}) | Countries ({{total_country}})</a></li>             
        <div ng-init="nav_list = {{data}}"></div>
        <li ng-repeat="nav in nav_list | filter:search | orderBy:'position'" onclick="nav_click_event(<[nav.id]>);" class="<[nav.class]>" my-repeat-directive>
          <a href="#" id="<[nav.id]>" class="<[nav.link_class]>"
            lat="<[nav.lat]>" lng="<[nav.lng]>">
            <i class="icon-picture" style="display:<[nav.image_style]>;"></i>
            <[nav.name]>
          </a>
        </li>
      </ul>  
    </div>    
    <div ng-controller="MapCtrl" id="map_container" class="span9 span12-tablet">      
      {% if user.is_authenticated %}
      <div class="navbar">
        <div class="navbar-inner">
          <div class="container">
          
            <a class="btn btn-navbar" data-toggle="collapse" data-target="#map_filter">
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </a>
          
            <a class="brand" href="#">{% trans "Display" %}</a>

            <div id="map_filter" class="nav-collapse collapse">
              <ul id="display_menu" class="nav">
                <li id="show_monk" class="">
                  <a href="#">{% trans "Monk" %}</a>
                </li>
                <li id="show_layperson" class="">
                  <a href="#">{% trans "Layperson" %}</a>
                </li>
              </ul>
              <ul class="nav pull-right">
                <li class="divider-vertical"></li>
                <li>
                  <a href="https://spreadsheets.google.com/viewform?formkey=dFRRZ3djOVVVX3IxYTExUEZDamI3enc6MQ">{% trans 'CDs/books request' %}</a>
                </li>              
              </ul>
            </div>            
          </div>
        </div>
      </div>
      {% endif %}
      
      <div ng-repeat="marker in myMarkers" ui-map-marker="myMarkers[$index]" 
        ui-event="{'map-click': 'show_dialog_info(marker)', 'map-mouseover': 'show_window_info(marker)', 'map-mouseout': 'dismiss_window_info(marker)'}">
      </div>

      <div ui-map-info-window="myInfoWindow" ng-bind-html="currentContent">
        <[ currentContent ]>
      </div>
      
      <div id="map_canvas" ui-map="myMap" class="map"
        ui-event="{'map-idle': 'init()'}" ui-options="mapOptions">
      </div>
      
    </div>
  </div>
    
  <div id="modal-gallery" class="modal modal-gallery hide fade modal-fullscreen" tabindex="-1" aria-hidden="true">
      <div class="modal-header">
          <a class="close" data-dismiss="modal">&times;</a>
          <h3 class="modal-title"></h3>
      </div>
      <div class="modal-body"><div class="modal-image"></div></div>
      <div class="modal-footer">
          <a class="btn btn-info modal-prev"><i class="icon-arrow-left icon-white"></i> Previous</a>
          <a class="btn btn-primary modal-next">Next <i class="icon-arrow-right icon-white"></i></a>
          <a class="btn btn-success modal-play modal-slideshow" data-slideshow="5000"><i class="icon-play icon-white"></i> Slideshow</a>
          <a class="btn modal-download" target="_blank"><i class="icon-download"></i> Download</a>
      </div>
  </div>
  
<script src="{{ STATIC_URL }}file_upload/js/load-image.min.js"></script>
<script src="{{ STATIC_URL }}bootstrap/js/bootstrap-image-gallery.js"></script>

<p id="back-top">
  <a href="#top"><span></span>Back to Top</a>
</p>

{% endblock %}

{% block footer %}{% include "footer.html" %}{% endblock %}

